{"version":3,"file":"client-app.js","sourceRoot":"","sources":["../../src/core/client-app.ts"],"names":[],"mappings":"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","sourcesContent":["const Vue = require(\"./../../vendor/vue.v2.5.16.js\");\n\n// public\nexport { Vue };\n\nconst VueRouter = require(\"./../../vendor/vue-router.v3.0.1.js\");\nVue.use(VueRouter);\n\n\nimport { given } from \"@nivinjoseph/n-defensive\";\nimport \"@nivinjoseph/n-ext\";\nimport { Container, ComponentInstaller } from \"@nivinjoseph/n-ject\";\nimport { ComponentManager } from \"./component-manager\";\nimport { PageManager } from \"./page-manager\";\nimport { InvalidOperationException } from \"@nivinjoseph/n-exception\";\nimport { DefaultDialogService } from \"./../services/dialog-service/default-dialog-service\";\nimport { DefaultEventAggregator } from \"./../services/event-aggregator/default-event-aggregator\";\nimport { DefaultNavigationService } from \"./../services/navigation-service/default-navigation-service\";\nimport { DefaultStorageService } from \"./../services/storage-service/default-storage-service\";\nimport { ConfigurationManager } from \"@nivinjoseph/n-config\";\nimport { DefaultDisplayService } from \"../services/display-service/default-display-service\";\n\n\n// public\nexport class ClientApp\n{\n    private readonly _appElementId: string;\n    private readonly _container: Container;\n    private readonly _componentManager: ComponentManager;\n    private readonly _pageManager: PageManager;\n    // @ts-ignore\n    private _app: any;\n    private _accentColor: string;\n    private _isBootstrapped: boolean = false;\n    \n    \n    public get container(): Container { return this._container; }\n\n\n    public constructor(appElementId: string)\n    {\n        given(appElementId, \"appElementId\").ensureHasValue().ensure(t => !t.isEmptyOrWhiteSpace()).ensure(t => t.startsWith(\"#\"));\n        this._appElementId = appElementId;\n        this._container = new Container();\n        this._componentManager = new ComponentManager(Vue, this._container);\n        this._pageManager = new PageManager(VueRouter, this._container);\n\n        Vue.config.silent = false;\n        Vue.config.devtools = false;\n        Vue.config.performance = false;\n        Vue.config.productionTip = false;\n    }\n\n\n    public useInstaller(installer: ComponentInstaller): this\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"useInstaller\");\n\n        given(installer, \"installer\").ensureHasValue();\n        this._container.install(installer);\n        return this;\n    }\n\n    public useAccentColor(color: string): this\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"useAccentColor\");\n\n        given(color, \"color\").ensureHasValue().ensure(t => !t.isEmptyOrWhiteSpace())\n            .ensure(t => t.trim().startsWith(\"#\"), \"must be hex value\");\n\n        this._accentColor = color.trim();\n        return this;\n    }\n\n    public registerComponents(...componentViewModelClasses: Function[]): this\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"registerComponents\");\n\n        this._componentManager.registerComponents(...componentViewModelClasses);\n        return this;\n    }\n\n    public registerPages(...pageViewModelClasses: Function[]): this\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"registerPages\");\n\n        this._pageManager.registerPages(...pageViewModelClasses);\n        return this;\n    }\n\n    public useAsInitialRoute(route: string): this\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"useAsInitialRoute\");\n        \n        given(route, \"route\").ensureHasValue().ensure(t => !t.isEmptyOrWhiteSpace());\n        this._pageManager.useAsInitialRoute(route);\n        return this;\n    }\n\n    public useAsUnknownRoute(route: string): this\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"useAsUnknownRoute\");\n\n        given(route, \"route\").ensureHasValue().ensure(t => !t.isEmptyOrWhiteSpace());\n        this._pageManager.useAsUnknownRoute(route);\n        return this;\n    }\n    \n    public useAsDefaultPageTitle(title: string): this\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"useAsDefaultPageTitle\");\n        \n        given(title, \"title\").ensureHasValue().ensure(t => !t.isEmptyOrWhiteSpace());\n        this._pageManager.useAsDefaultPageTitle(title);\n        return this;\n    }\n    \n    public useAsDefaultPageMetadata(...metas: Array<{ name: string; content: string; }>): this\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"useAsDefaultPageMetadata\");\n        \n        given(metas, \"metas\").ensureHasValue().ensureIsArray().ensure(t => t.length > 0);\n        this._pageManager.useAsDefaultPageMetadata(metas);\n        return this;\n    }\n    \n    public useHistoryModeRouting(): this\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"useHistoryModeRouting\");\n        \n        // if (this._initialRoute)\n        //     throw new InvalidOperationException(\"Cannot use history mode with initial route.\");\n        \n        this._pageManager.useHistoryModeRouting();\n        return this;\n    }\n\n    // public enableDevMode(): this\n    // {\n    //     if (this._isbootstrapped)\n    //         throw new InvalidOperationException(\"enableDevMode\");\n\n    //     Config.enableDev(Vue);\n    //     return this;\n    // }\n\n    public bootstrap(): void\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"bootstrap\");\n\n        this.configureGlobalConfig();\n        this.configureComponents();\n        this.configurePages();\n        this.configureCoreServices();\n        this.configureContainer();\n        this.configureRoot();\n\n        this._isBootstrapped = true;\n        // this._pageManager.configureInitialRoute();\n    }\n    \n    public retrieveRouterInstance(): object\n    {\n        if (!this._isBootstrapped)\n            throw new InvalidOperationException(\"calling retrieveRouterInstance before calling bootstrap\");\n        \n        if (this._pageManager.vueRouterInstance === null)\n            throw new InvalidOperationException(\"calling retrieveRouterInstance with no page registrations\");\n        \n        return this._pageManager.vueRouterInstance;\n    }\n    \n    \n    private configureGlobalConfig(): void\n    {\n        if (ConfigurationManager.getConfig(\"env\") === \"dev\")\n        {\n            console.log(\"Bootstrapping in DEV mode.\");\n\n            Vue.config.silent = false;\n            Vue.config.devtools = true;\n            Vue.config.performance = true;\n            Vue.config.productionTip = true;\n        }\n        else\n        {\n            Vue.config.silent = true;\n            Vue.config.devtools = false;\n            Vue.config.performance = false;\n            Vue.config.productionTip = false;\n        }\n    }\n\n\n    private configureComponents(): void\n    {\n        this._componentManager.bootstrap();\n    }\n\n    private configurePages(): void\n    {\n        this._pageManager.bootstrap();\n    }\n\n    private configureCoreServices(): void\n    {\n        this._container\n            .registerInstance(\"DialogService\", new DefaultDialogService(this._accentColor))\n            .registerInstance(\"EventAggregator\", new DefaultEventAggregator())\n            .registerInstance(\"NavigationService\", new DefaultNavigationService(this._pageManager.vueRouterInstance))\n            .registerInstance(\"StorageService\", new DefaultStorageService())\n            .registerInstance(\"DisplayService\", new DefaultDisplayService())\n            ;\n    }\n\n    private configureContainer(): void\n    {\n        this._container.bootstrap();\n    }\n\n    private configureRoot(): void\n    {\n        const container = this._container;\n        \n        this._app = new Vue({\n            el: this._appElementId,\n            router: this._pageManager.vueRouterInstance,\n            provide: function ()\n            {\n                return {\n                    rootScopeContainer: container\n                };\n            }\n        });\n    }\n}"]}